<form #locationForm="ngForm">
  <ng-template #modal let-modal>
    <div class="modal-header" [ngClass]="confirmation">
      <h4 class="modal-title" id="modal-basic-title">Location</h4>
    </div>
    <div class="modal-body" [ngClass]="confirmation">
      <div class="col-lg-12" [hidden]="!showLocationId">
        <label for="street">Location Id:</label>
        <input type="text" class="form-control" id="locationId" [readonly]="true" [(ngModel)]="location.locationId"
          name="locationId" #locationId="ngModel">
      </div>
      <div class="empty-row"></div>
      <div class="col-lg-12">
        <label for="street">Address Street 1</label>
        <input type="text" class="form-control" id="street" [readonly]="!canEdit" maxlength="40"
          [(ngModel)]="location.street" name="street" #street="ngModel" autofocus>
      </div>
      <div class="empty-row"></div>
      <div class="col-lg-12">
        <label for="street2">Address Street 2</label>
        <input type="text" class="form-control" id="street2" [readonly]="!canEdit" [(ngModel)]="location.street2"
          maxlength="40" name="street2" #street2="ngModel">
      </div>
      <div class="empty-row"></div>
      <div class="col-lg-12">
        <label for="zipCode">Zip Code</label>
        <input type="text" class="form-control" id="zipCode" [readonly]="!canEdit" [required]="canEdit"
          zip-code [(ngModel)]="location.zip" name="zipCode" #zip="ngModel"
          (ngModelChange)="changeZipCode()">
      </div>
      <div [hidden]="isZipCodeFormatValid" class="alert alert-danger">
        Zip Code is invalid for {{location.countryCode}}
      </div>
      <div class="empty-row"></div>
      <div class="col-lg-12">
        <label for="city">City</label>
        <div *ngIf="isLoadingAddress">
          <div class="spinner-border ml-auto" role="status" aria-hidden="true">
          </div>
        </div>
        <div *ngIf="!isLoadingAddress">
          <input type="text" class="form-control" id="city" [readonly]="!canEdit || isLoadingAddress" maxlength="25"
            [required]="canEdit" [(ngModel)]="location.city" name="city" #city="ngModel">
        </div>
      </div>
      <div class="empty-row"></div>
      <div class="col-lg-12">
        <label for="locationState">State</label>
        <div *ngIf="isLoadingAddress">
          <div class="spinner-border ml-auto" role="status" aria-hidden="true">
          </div>
        </div>
        <div *ngIf="!isLoadingAddress">
          <ng-select id="locationState" [items]="states$ | async" bindLabel="name" bindValue="code"
            [clearable]="false" [readonly]="!canEdit || isLoadingAddress" name="locationState" [required]="canEdit"
            [(ngModel)]="location.state" #locationState="ngModel" (change)="changeState($event)">
          </ng-select>
        </div>
      </div>
      <div class="empty-row"></div>
      <div class="col-lg-12">
        <label for="locationCounty">County</label>
        <div *ngIf="isLoadingAddress">
          <div class="spinner-border ml-auto" role="status" aria-hidden="true">
          </div>
        </div>
        <div *ngIf="!isLoadingAddress">
          <div *ngIf="counties.length <= 1">
            <input type="text" class="form-control" id="locationCounty" [readonly]="!canEdit || isLoadingAddress"
              maxlength="100" [(ngModel)]="location.county" name="locationCounty" #locationCounty="ngModel">
          </div>
          <div *ngIf="counties.length > 1">
            <ng-select id="locationCounty" [items]="counties" [clearable]="false"
              [readonly]="!canEdit || isLoadingAddress" name="locationCounty" [(ngModel)]="location.county"
              #locationCounty="ngModel">
            </ng-select>
          </div>
        </div>
      </div>
    </div>
    <div class="modal-footer" [ngClass]="confirmation">
      <button type="button" class="btn btn-primary" [hidden]="!canEdit"
        [disabled]="!locationForm.valid || !isDirty || isLoadingAddress || !isZipCodeFormatValid" (click)="save()">Save</button>
      <button type="button" class="btn btn-danger" [hidden]="!canEdit || !canDeleteLocation"
        [disabled]="isLoadingAddress" (click)="openDeleteConfirmation()">Delete</button>
      <button type="button" class="btn btn-secondary" [hidden]="!canEdit" (click)="cancel()">Cancel</button>
      <button type="button" class="btn btn-secondary" [hidden]="canEdit" (click)="cancel()">Close</button>
    </div>
  </ng-template>
</form>