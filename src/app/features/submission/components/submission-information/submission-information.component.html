<div id="saveHeader">
  <button class="btn btn-md btn-primary" *ngIf="canEditSubmission" style="margin: 5px;" [disabled]="!isDirty() || !isValid()" appPreventDoubleClick
    (throttledClick)="save()" [throttleTime]="700">Save</button>
    <button class="btn btn-md btn-primary" *ngIf="canEditSubmission && this.previousUrl !== ''" style="margin: 5px;" appPreventDoubleClick
    (throttledClick)="prev()" [throttleTime]="700">{{previousLabel}}</button>
</div>
<ngb-alert
  *ngIf="showInvalid"
  type="danger"
  (closed)="hideInvalid()"
  [dismissible]="true"
  [innerHTML]="invalidMessage"
>
</ngb-alert>
<form #submissionInfoForm="ngForm">
  <div class="card">
    <div class="card-header" (click)="collapse.toggle()">
      Submission Information - {{ submission.submissionNumber }}
      <fa-icon
        style="float: right"
        [icon]="faAngleDown"
        *ngIf="submissionCollapsed"
      ></fa-icon>
      <fa-icon
        style="float: right"
        [icon]="faAngleUp"
        *ngIf="!submissionCollapsed"
      ></fa-icon>
    </div>
    <div #collapse="ngbCollapse" [(ngbCollapse)]="submissionCollapsed">
      <div class="card-body" id="card-header">
        <div class="row">
          <div class="panel">
            <div class="row">
              <div *ngIf="submission.insured != null" class="col-lg-6">
                <div class="col-lg-12">
                  <a
                    [routerLink]="[]"
                    (click)="
                      submission.insuredCode != null
                        ? routeToInsured(submission.insuredCode)
                        : null
                    "
                    >{{ submission.insured.name }}</a
                  >
                </div>
                <div class="col-lg-12">
                  {{ submission.insured.street1 }}
                </div>
                <div class="col-lg-12">
                  {{ submission.insured.city }}, {{ submission.insured.state }}
                  {{ submission.insured.zip }}
                </div>
              </div>
              <div class="col-lg-6">
                <div class="col-lg-12">
                  <label for="sicCode" class="form-label" title="SIC Code"
                    >SIC Code</label
                  >
                  <ng-select
                    id="sicCode"
                    [items]="sicCodes$ | async"
                    bindLabel="description"
                    bindValue="code"
                    [readonly]="!canEditSubmission"
                    name="sicCode"
                    [(ngModel)]="submission.sicCode"
                    [loading]="loadingSic"
                    loadingText="Loading..."
                    [searchFn]="dropDownSearch"
                    #sicCode="ngModel"
                    (change)="changeSicCode()"
                    [virtualScroll]="true"
                  >
                    <ng-template ng-label-tmp let-item="item">
                      {{ item.code }} - {{ item.description }}
                    </ng-template>
                    <ng-template ng-option-tmp let-item="item">
                      {{ item.code }} - {{ item.description }}
                    </ng-template>
                  </ng-select>
                </div>
                <div class="col-lg-12">
                  <label for="naics" class="form-label" title="NAICS"
                    >NAICS</label
                  >
                  <ng-select
                    id="naics"
                    [items]="naicsCodes$ | async"
                    bindLabel="description"
                    bindValue="code"
                    [readonly]="!canEditSubmission"
                    name="naics"
                    [(ngModel)]="submission.naicsCode"
                    [loading]="loadingNaics"
                    loadingText="Loading..."
                    #naics="ngModel"
                  >
                    <ng-template ng-label-tmp let-item="item">
                      {{ item.code }} - {{ item.description }}
                    </ng-template>
                    <ng-template ng-option-tmp let-item="item">
                      {{ item.code }} - {{ item.description }}
                    </ng-template>
                  </ng-select>
                </div>
                <!-- <div class="col-lg-12">
                <label>Class Code</label>
                ??
              </div> -->
              </div>
            </div>
            <div class="row">
              <div class="col-lg-4">
                <rsps-submission-info-panel-left
                  #panelLeft
                  [submission]="submission"
                ></rsps-submission-info-panel-left>
              </div>
              <div class="col-lg-8">
                <rsps-submission-info-panel-right
                  #panelRight
                  [submission]="submission"
                ></rsps-submission-info-panel-right>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>

  <div *ngIf="submission.submissionEvents" class="card">
    <div class="card-header" (click)="collapse.toggle()">Event History
      <fa-icon style="float: right" [icon]="faAngleDown" *ngIf="seCollapsed"></fa-icon>
      <fa-icon style="float: right" [icon]="faAngleUp" *ngIf="!seCollapsed"></fa-icon>
    </div>
    <div #collapse="ngbCollapse" [(ngbCollapse)]="seCollapsed">
      <table class="table table-striped table-bordered">
          <thead id="seHeader">
            <tr>
              <th>Event Description</th>
              <th>Reason</th>
              <th>Remarks</th>
              <th>Event Date</th>
              <th>Created By</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let subEvent of submission.submissionEvents; let i = index">
              <ng-container>
                    <td>{{subEvent.eventDescription}}</td>
                    <td>{{subEvent.reasonDescription}}</td>
                    <td>{{subEvent.remarks}}</td>
                    <td>{{formatDateForDisplay.formatDateForDisplay(subEvent.eventDate)}}</td>
                    <td>{{subEvent.createdByUserName || '--'}}</td>
              </ng-container>
            </tr>
          </tbody>
        </table>
    </div>
  </div>

</form>

<div *ngIf="showBusy">
  <rsps-busy></rsps-busy>
</div>
