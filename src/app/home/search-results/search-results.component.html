<div class="d-flex justify-content-center" *ngIf="loading">
  <strong>Loading...</strong>
  <div class="spinner-border ml-auto" role="status" aria-hidden="true"></div>
</div>
<div class="card">
  <div class="card-header" (click)="collapsed = !collapsed">Policy Transactions
    <fa-icon style="float: right" [icon]="faAngleDown" *ngIf="collapsed"></fa-icon>
    <fa-icon style="float: right" [icon]="faAngleUp" *ngIf="!collapsed"></fa-icon>
  </div>
  <div #collapse="ngbCollapse" [(ngbCollapse)]="collapsed">
    <div id="searchHeader" class="card-header" *ngIf="searchResults && searchResults.length">
      <div class="row container" *ngIf="searchResults && searchResults.length">
        <div class="col-lg-7">Named Insured: <b>{{insuredName}}</b></div>
        <div class="col-lg-5">Status:
          <span [ngClass]="status"><b>{{status}}</b></span>
        </div>
      </div>
    </div>
    <div >
      <table class="table table-striped table-bordered" *ngIf="searchResults && searchResults.length">
        <thead>
          <tr>
            <th>PolicyId</th>
            <th>Policy No</th>
            <th>End No</th>
            <th>Policy Eff Date</th>
            <th>Policy Exp Date</th>
            <th>Extended Exp Date</th>
            <th>Invoice No</th>
            <th>Invoice Date</th>
            <th>Trans Eff Date</th>
            <th>Trans Exp Date</th>
            <th>Void Date</th>
            <th>Status</th>
            <th>Trans Type</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let policy of searchResults; let i = index" [ngClass]="{'policyBorder':policy.firstPolicyRow && i != 0}">
            <td>
              <span *ngIf="policy.firstPolicyRow">{{ policy.policyId }}</span>
            </td>
            <td><a [routerLink]="[]" (click)="openPolicy(policy)">
            <td nowrap="nowrap">{{policy.policyNumber}}</td></a></td>
            <td>{{ policy.endorsementNumber }}</td>
            <td>
              <span *ngIf="policy.firstPolicyRow">{{ policy.policyEffectiveDate | date: 'MM/dd/yyyy'}}</span>
            </td>
            <td>
              <span *ngIf="policy.firstPolicyRow">{{ policy.policyExpirationDate | date: 'MM/dd/yyyy'}}</span>
            </td>
            <td>
              <span *ngIf="policy.firstPolicyRow">{{ policy.policyExtendedDate | date: 'MM/dd/yyyy'}}</span>
            </td>
            <td>{{ policy.invoiceNumber}}</td>
            <td>{{ policy.invoiceDate | date: 'MM/dd/yyyy'}}</td>
            <td>{{ policy.transactionEffectiveDate | date: 'MM/dd/yyyy'}}</td>
            <td>{{ policy.transactionExpirationDate | date: 'MM/dd/yyyy'}}</td>
            <td>{{ policy.voidDate | date: 'MM/dd/yyyy'}}</td>
            <td>{{ policy.invoiceStatus}}</td>
            <td>{{ policy.transactionType}}</td>
            <td id="actionCell">
                  <div ngbDropdown style="margin-top: 6%">
                    <button  id="action" ngbDropdownToggle>Actions</button>
                    <div ngbDropdownMenu aria-labelledby="action">
                      <button ngbDropdownItem (click)="newEndorsement(policy)" value="endorsement">Endorsement</button>
                    </div>
                  </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
  <div class="card-footer" >
    <div id="searchFooter">
      <div style="float:right;">Results: {{searchResults.length}}</div> 
    </div>
  </div>
</div>
<rsps-action #modal></rsps-action>